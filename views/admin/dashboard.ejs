<% layout('layouts/boilerplate')%>
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-3"><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
            <p class="lead">Manage Programs, Schools, and Enrollments</p>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="programs-tab" data-bs-toggle="tab" data-bs-target="#programs" type="button" role="tab">
                <i class="fas fa-graduation-cap"></i> Programs
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="schools-tab" data-bs-toggle="tab" data-bs-target="#schools" type="button" role="tab">
                <i class="fas fa-school"></i> Schools
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="enrollments-tab" data-bs-toggle="tab" data-bs-target="#enrollments" type="button" role="tab">
                <i class="fas fa-link"></i> School-Program Enrollments
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="problems-tab" data-bs-toggle="tab" data-bs-target="#problems" type="button" role="tab">
                <i class="fas fa-lightbulb"></i> Problem Statements (<%= totalProblems || 0 %>)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="problem-creators-tab" data-bs-toggle="tab" data-bs-target="#problem-creators" type="button" role="tab">
                <i class="fas fa-user-tie"></i> Problem Creators (<%= problemCreators ? problemCreators.length : 0 %>)
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="adminTabsContent">
        <!-- PROGRAMS TAB -->
        <div class="tab-pane fade show active" id="programs" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-plus"></i> Add New Program</h5>
                        </div>
                        <div class="card-body">
                            <form action="/admin/programs" method="POST">
                                <div class="mb-3">
                                    <label for="programName" class="form-label">Program Name</label>
                                    <input type="text" class="form-control" id="programName" name="name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="programDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="programDescription" name="description" rows="3"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Add Program</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">All Programs (<%= programs.length %>)</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (programs.length === 0) { %>
                                            <tr>
                                                <td colspan="4" class="text-center text-muted">No programs found. Add your first program!</td>
                                            </tr>
                                        <% } else { %>
                                            <% programs.forEach(program => { %>
                                                <tr>
                                                    <td><strong><%= program.name %></strong></td>
                                                    <td><%= program.description || '-' %></td>
                                                    <td>
                                                        <% if (program.isActive) { %>
                                                            <span class="badge bg-success">Active</span>
                                                        <% } else { %>
                                                            <span class="badge bg-secondary">Inactive</span>
                                                        <% } %>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary" onclick="editProgram('<%= program._id %>', '<%= program.name %>', '<%= program.description || '' %>', <%= program.isActive %>)">
                                                            <i class="fas fa-edit"></i> Edit
                                                        </button>
                                                        <form action="/admin/programs/<%= program._id %>?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this program?');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                                <i class="fas fa-trash"></i> Delete
                                                            </button>
                                                        </form>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHOOLS TAB -->
        <div class="tab-pane fade" id="schools" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-plus"></i> Add New School</h5>
                        </div>
                        <div class="card-body">
                            <form action="/admin/schools" method="POST">
                                <div class="mb-3">
                                    <label for="schoolName" class="form-label">School Name</label>
                                    <input type="text" class="form-control" id="schoolName" name="name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="schoolAddress" class="form-label">Address</label>
                                    <input type="text" class="form-control" id="schoolAddress" name="address">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="schoolCity" class="form-label">City</label>
                                        <input type="text" class="form-control" id="schoolCity" name="city">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="schoolState" class="form-label">State</label>
                                        <input type="text" class="form-control" id="schoolState" name="state">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="schoolCountry" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="schoolCountry" name="country" value="India">
                                </div>
                                <button type="submit" class="btn btn-success w-100">Add School</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">All Schools (<%= schools.length %>)</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (schools.length === 0) { %>
                                            <tr>
                                                <td colspan="4" class="text-center text-muted">No schools found. Add your first school!</td>
                                            </tr>
                                        <% } else { %>
                                            <% schools.forEach(school => { %>
                                                <tr>
                                                    <td><strong><%= school.name %></strong></td>
                                                    <td>
                                                        <%= school.city || '' %><% if (school.city && school.state) { %>, <% } %>
                                                        <%= school.state || '' %>
                                                    </td>
                                                    <td>
                                                        <% if (school.isActive) { %>
                                                            <span class="badge bg-success">Active</span>
                                                        <% } else { %>
                                                            <span class="badge bg-secondary">Inactive</span>
                                                        <% } %>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-success" onclick="editSchool('<%= school._id %>', '<%= school.name %>', '<%= school.address || '' %>', '<%= school.city || '' %>', '<%= school.state || '' %>', '<%= school.country || 'India' %>', <%= school.isActive %>)">
                                                            <i class="fas fa-edit"></i> Edit
                                                        </button>
                                                        <form action="/admin/schools/<%= school._id %>?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this school? This will also remove all enrollments.');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                                <i class="fas fa-trash"></i> Delete
                                                            </button>
                                                        </form>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ENROLLMENTS TAB -->
        <div class="tab-pane fade" id="enrollments" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-link"></i> Enroll School in Program</h5>
                        </div>
                        <div class="card-body">
                            <form action="/admin/school-programs" method="POST">
                                <div class="mb-3">
                                    <label for="enrollSchool" class="form-label">School</label>
                                    <select class="form-select" id="enrollSchool" name="schoolId" required>
                                        <option value="">Select a School</option>
                                        <% schools.forEach(school => { %>
                                            <option value="<%= school._id %>"><%= school.name %></option>
                                        <% }); %>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="enrollProgram" class="form-label">Program</label>
                                    <select class="form-select" id="enrollProgram" name="programId" required>
                                        <option value="">Select a Program</option>
                                        <% programs.forEach(program => { %>
                                            <option value="<%= program._id %>"><%= program.name %></option>
                                        <% }); %>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="numberOfStudents" class="form-label">Number of Students</label>
                                    <input type="number" class="form-control" id="numberOfStudents" name="numberOfStudents" min="0" value="0" required>
                                </div>
                                <button type="submit" class="btn btn-info w-100">Enroll School</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">All Enrollments (<%= schoolPrograms.length %>)</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>School</th>
                                            <th>Program</th>
                                            <th>Students</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (schoolPrograms.length === 0) { %>
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">No enrollments found. Enroll a school in a program!</td>
                                            </tr>
                                        <% } else { %>
                                            <% schoolPrograms.forEach(enrollment => { %>
                                                <tr>
                                                    <td><strong><%= enrollment.school ? enrollment.school.name : 'N/A' %></strong></td>
                                                    <td><%= enrollment.program ? enrollment.program.name : 'N/A' %></td>
                                                    <td><%= enrollment.numberOfStudents || 0 %></td>
                                                    <td>
                                                        <% if (enrollment.isActive) { %>
                                                            <span class="badge bg-success">Active</span>
                                                        <% } else { %>
                                                            <span class="badge bg-secondary">Inactive</span>
                                                        <% } %>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-info" onclick="editEnrollment('<%= enrollment._id %>', '<%= enrollment.numberOfStudents || 0 %>', <%= enrollment.isActive %>)">
                                                            <i class="fas fa-edit"></i> Edit
                                                        </button>
                                                        <form action="/admin/school-programs/<%= enrollment._id %>?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to remove this enrollment?');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                                <i class="fas fa-unlink"></i> Remove
                                                            </button>
                                                        </form>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROBLEM STATEMENTS TAB -->
        <div class="tab-pane fade" id="problems" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-upload"></i> Upload Excel File</h5>
                        </div>
                        <div class="card-body">
                            <form action="/admin/upload-problems" method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="excelFile" class="form-label">Select Excel File (.xlsx or .xls)</label>
                                    <input type="file" class="form-control" id="excelFile" name="excelFile" accept=".xlsx,.xls" required>
                                    <small class="form-text text-muted">
                                        Excel file should have columns: <strong>SDG Goal</strong>, <strong>Problem Statement</strong>, and optionally <strong>Recommended Stakeholders</strong> (comma-separated)
                                    </small>
                                </div>
                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="fas fa-upload"></i> Upload and Import
                                </button>
                            </form>
                            
                            <hr>
                            
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle"></i> Excel Format Requirements:</h6>
                                <small>
                                    <strong>⚠️ IMPORTANT:</strong> Headers must be in <strong>Row 1</strong> (first row) with no empty rows above!<br><br>
                                    <strong>Column A:</strong> SDG Goal (e.g., "No Poverty", "Zero Hunger")<br>
                                    <strong>Column B:</strong> Problem Statement<br>
                                    <strong>Column C:</strong> Recommended Stakeholder 1 (optional)<br>
                                    <strong>Column D:</strong> Recommended Stakeholder 2 (optional)<br>
                                    <strong>Column E:</strong> Recommended Stakeholder 3 (optional)<br>
                                    <br>
                                    <strong>If exporting from Numbers:</strong><br>
                                    1. Delete the metadata row ("This document was exported from Numbers...")<br>
                                    2. Make sure headers are in Row 1<br>
                                    3. Export as Excel (.xlsx) format<br>
                                    <br>
                                    <em>Note: Column names are flexible - the system will recognize columns containing "SDG", "Goal", "Problem", "Statement", "Stakeholder"</em>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">All Problem Statements (<%= totalProblems || 0 %>)</h5>
                        </div>
                        <div class="card-body">
                            <% if (problemSummary && problemSummary.length > 0) { %>
                                <div class="mb-3">
                                    <h6>Summary by SDG Goal:</h6>
                                    <div class="d-flex flex-wrap gap-2">
                                        <% problemSummary.forEach(item => { %>
                                            <span class="badge bg-secondary">
                                                <%= item._id %>: <%= item.count %>
                                            </span>
                                        <% }); %>
                                    </div>
                                </div>
                            <% } %>
                            
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Problem statements are displayed on Page 2 of Problem Discovery based on the selected SDG Goal.
                            </div>
                            
                            <p class="text-muted">
                                To view all problem statements, use the API endpoint: <code>/admin/problems</code>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROBLEM CREATORS TAB -->
        <div class="tab-pane fade" id="problem-creators" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-user-tie"></i> Manage Problem Creators</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Problem Creators</strong> can create and manage Corporate Problem Statements that are visible to all users.
                                Users can adopt these problems and work on them through the innovation process.
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="text-white mb-3">
                                    <i class="fas fa-users"></i> Current Problem Creators 
                                    <span class="badge bg-success"><%= problemCreators ? problemCreators.length : 0 %></span>
                                </h5>
                                <% if (problemCreators && problemCreators.length > 0) { %>
                                    <div class="table-responsive">
                                        <table class="table table-dark table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Username</th>
                                                    <th>Email</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% problemCreators.forEach(user => { %>
                                                <tr>
                                                    <td><%= user.username %></td>
                                                    <td><%= user.email %></td>
                                                    <td>
                                                        <span class="badge bg-success">Problem Creator</span>
                                                        <% if (user.isAdmin) { %>
                                                        <span class="badge bg-primary">Admin</span>
                                                        <% } %>
                                                    </td>
                                                    <td>
                                                        <form action="/admin/users/<%= user._id %>/remove-problem-creator" method="POST" class="d-inline">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove problem creator status from <%= user.username %>?')">
                                                                <i class="fas fa-user-minus"></i> Remove
                                                            </button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                <% } else { %>
                                    <p class="text-muted">No problem creators yet.</p>
                                <% } %>
                            </div>
                            
                            <hr class="my-4" style="border-color: rgba(255,255,255,0.1);">
                            
                            <div>
                                <h5 class="text-white mb-3">
                                    <i class="fas fa-user-plus"></i> All Users - Add Problem Creator
                                </h5>
                                <div class="mb-3">
                                    <input type="text" id="userSearch" class="form-control" placeholder="Search users by username or email..." onkeyup="filterUsers()">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped" id="usersTable">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Username</th>
                                                <th>Email</th>
                                                <th>Current Roles</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% if (allUsers && allUsers.length > 0) { %>
                                                <% allUsers.forEach((user, index) => { %>
                                                <tr class="user-row">
                                                    <td><%= index + 1 %></td>
                                                    <td class="username-cell"><strong><%= user.username %></strong></td>
                                                    <td class="email-cell"><%= user.email %></td>
                                                    <td>
                                                        <% if (user.isAdmin) { %>
                                                        <span class="badge bg-primary">Admin</span>
                                                        <% } %>
                                                        <% if (user.isProblemCreator) { %>
                                                        <span class="badge bg-success">Problem Creator</span>
                                                        <% } %>
                                                        <% if (!user.isAdmin && !user.isProblemCreator) { %>
                                                        <span class="badge bg-secondary">Regular User</span>
                                                        <% } %>
                                                    </td>
                                                    <td>
                                                        <% if (!user.isProblemCreator) { %>
                                                        <form action="/admin/users/<%= user._id %>/make-problem-creator" method="POST" class="d-inline">
                                                            <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('Make <%= user.username %> a Problem Creator?')">
                                                                <i class="fas fa-user-plus"></i> Make Problem Creator
                                                            </button>
                                                        </form>
                                                        <% } else { %>
                                                        <span class="text-success">
                                                            <i class="fas fa-check-circle"></i> Already a Problem Creator
                                                        </span>
                                                        <% } %>
                                                    </td>
                                                </tr>
                                                <% }); %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="5" class="text-center text-muted py-4">
                                                        <i class="fas fa-users fa-2x mb-2"></i><br>
                                                        No users found
                                                    </td>
                                                </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Program Modal -->
<div class="modal fade" id="editProgramModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Program</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editProgramForm" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="_method" value="PUT">
                    <div class="mb-3">
                        <label for="editProgramName" class="form-label">Program Name</label>
                        <input type="text" class="form-control" id="editProgramName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editProgramDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editProgramDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editProgramActive" name="isActive">
                            <label class="form-check-label" for="editProgramActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Program</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit School Modal -->
<div class="modal fade" id="editSchoolModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit School</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editSchoolForm" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="_method" value="PUT">
                    <div class="mb-3">
                        <label for="editSchoolName" class="form-label">School Name</label>
                        <input type="text" class="form-control" id="editSchoolName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSchoolAddress" class="form-label">Address</label>
                        <input type="text" class="form-control" id="editSchoolAddress" name="address">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editSchoolCity" class="form-label">City</label>
                            <input type="text" class="form-control" id="editSchoolCity" name="city">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editSchoolState" class="form-label">State</label>
                            <input type="text" class="form-control" id="editSchoolState" name="state">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editSchoolCountry" class="form-label">Country</label>
                        <input type="text" class="form-control" id="editSchoolCountry" name="country">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editSchoolActive" name="isActive">
                            <label class="form-check-label" for="editSchoolActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Update School</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Enrollment Modal -->
<div class="modal fade" id="editEnrollmentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Enrollment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editEnrollmentForm" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="_method" value="PUT">
                    <div class="mb-3">
                        <label for="editNumberOfStudents" class="form-label">Number of Students</label>
                        <input type="number" class="form-control" id="editNumberOfStudents" name="numberOfStudents" min="0" required>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editEnrollmentActive" name="isActive">
                            <label class="form-check-label" for="editEnrollmentActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-info">Update Enrollment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editProgram(id, name, description, isActive) {
    document.getElementById('editProgramForm').action = `/admin/programs/${id}`;
    document.getElementById('editProgramName').value = name;
    document.getElementById('editProgramDescription').value = description || '';
    document.getElementById('editProgramActive').checked = isActive;
    new bootstrap.Modal(document.getElementById('editProgramModal')).show();
}

function editSchool(id, name, address, city, state, country, isActive) {
    document.getElementById('editSchoolForm').action = `/admin/schools/${id}`;
    document.getElementById('editSchoolName').value = name;
    document.getElementById('editSchoolAddress').value = address || '';
    document.getElementById('editSchoolCity').value = city || '';
    document.getElementById('editSchoolState').value = state || '';
    document.getElementById('editSchoolCountry').value = country || 'India';
    document.getElementById('editSchoolActive').checked = isActive;
    new bootstrap.Modal(document.getElementById('editSchoolModal')).show();
}

function editEnrollment(id, numberOfStudents, isActive) {
    document.getElementById('editEnrollmentForm').action = `/admin/school-programs/${id}`;
    document.getElementById('editNumberOfStudents').value = numberOfStudents;
    document.getElementById('editEnrollmentActive').checked = isActive;
    new bootstrap.Modal(document.getElementById('editEnrollmentModal')).show();
}

// Filter users in the problem creators table
function filterUsers() {
    const input = document.getElementById('userSearch');
    if (!input) return;
    const filter = input.value.toLowerCase();
    const table = document.getElementById('usersTable');
    if (!table) return;
    const rows = table.getElementsByTagName('tr');
    
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const usernameCell = row.querySelector('.username-cell');
        const emailCell = row.querySelector('.email-cell');
        
        if (usernameCell && emailCell) {
            const username = usernameCell.textContent.toLowerCase();
            const email = emailCell.textContent.toLowerCase();
            
            if (username.includes(filter) || email.includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
    }
}
</script>


